<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<meta name="description" content="">
<meta name="author" content="">

<title>Route to My Office</title>

<!-- Bootstrap core CSS -->
<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">

<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<link href="bootstrap/css/ie10-viewport-bug-workaround.css"
	rel="stylesheet">

<!-- Custom styles for this template -->
<link href="bootstrap/css/dashboard.css" rel="stylesheet">

<!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
<!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
<script src="bootstrap/js/ie-emulation-modes-warning.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="bootstrap/js/bootstrap.min.js"></script>

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

<style>
html, body {
	height: 95%;
	margin: 0;
	padding: 0;
}

#map {
	margin-left: 3%;
	margin-top: 2%;
	height: 80%;
}

#right-panel {
	font-family: 'Roboto', 'sans-serif';
	line-height: 30px;
	padding-left: 10px;
	margin-right: 3%;
}

#right-panel select, #right-panel input {
	font-size: 15px;
}

#right-panel select {
	width: 100%;
}

#right-panel i {
	font-size: 12px;
}

#right-panel {
	margin-top: 2%;
	height: 80%;
	float: right;
	width: 390px;
	overflow: auto;
}

@media print {
	#map {
		height: 500px;
		margin: 0;
	}
	#right-panel {
		float: none;
		width: auto;
	}
}
</style>
</head>
<body>

	<nav class="navbar navbar-inverse navbar-fixed-top">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed"
					data-toggle="collapse" data-target="#navbar" aria-expanded="false"
					aria-controls="navbar">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>

			</div>
			<div id="navbar" class="navbar-collapse collapse">
				<ul class="nav navbar-nav navbar-left">
					<li><a id="getDirectionStart"
						data-value="47.604004, -122.131133"> Start: 546 156th Avenue
							Southeast, Bellevue, WA </a></li>
					<li>
				</ul>
			</div>
		</div>
	</nav>
	<br />

	<div class="container-fluid">
		<div class="row">
			<div class="col-sm-10 col-md-12 main">
				<h2 class="sub-header">List of places I frequently go to:</h2>
				<p id="getDirectionDestination1" data-value="47.645014, -122.122219"></p>

				<!-- 				<span id="helpBlock" class="help-block">Below list is limited to coffee shops very close(< 3miles) to my office, so that I can enjoy a hot cup of coffee :) </span> -->
				<!-- 				<span id="helpBlock" class="help-block">Select any one of the coffee shops or select multiple and click on Get Directions! </span> -->
				<!-- 				<span id="helpBlock" class="help-block">Directions will be displayed on the right side of the map, including stopovers at selected the coffee shop(s) </span> -->
				<div class="table-responsive">
					<table class="table table-striped table-condensed table-bordered"
						id="favPlaces">
						<thead>
							<tr>
								<th>#</th>
								<th>Name</th>
								<th>Address</th>
								<th>Long URL</th>
								<th>Short URL</th>
								<th>URL Info</th>

							</tr>
						</thead>
						<tbody>
							<tr>
								<th><input type="radio" name="destination" value="47.645137,-122.122208"/></th>
								<th>My Office</th>
								<th> Microsoft Building 30, 163rd Avenue Northeast, Redmond, WA</th>
								<th><a target="_blank" href="https://www.google.com/maps/dir/546+156th+Ave+SE,+Bellevue,+WA+98007/
									Microsoft+Bldg+30,+3910+163rd+Ave+NE,+Redmond,+WA+98052/@47.6246777,-122.1583691,13z/
									data=!3m1!4b1!4m13!4m12!1m5!1m1!1s0x54906c333b56747b:0x842e9a13e8e6fc9d!2m2!1d-122.1311222!2d47.6039896!1m5!1m1!1s0x54906d7a9293db0b:0x63fa3752785e2250!2m2!1d-122.1222083!2d47.6449778">https://www.google.com/maps/dir/546+156th+Ave+SE,+Bellevue,+WA+98007/
									Microsoft+Bldg+30,+3910+163rd+Ave+NE,+Redmond,+WA+98052/@47.6246777,-122.1583691,13z/
									data=!3m1!4b1!4m13!4m12!1m5!1m1!1s0x54906c333b56747b:0x842e9a13e8e6fc9d!2m2!1d-122.1311222!2d47.6039896!1m5!1m1!1s0x54906d7a9293db0b:0x63fa3752785e2250!2m2!1d-122.1222083!2d47.6449778</a></th>
								<th><a href="http://bit.ly/1puY17G" target="_blank">bit.ly/1puY17G</a></th>
								<th><button type="button" class="btn btn-success linkBtn" value="http://bit.ly/1puY17G">Get Info</button></th>
							</tr>
							<tr>
								<th><input type="radio" name="destination" value="47.634808, -122.140501"/></th>
								<th>Starbucks near my office</th>
								<th> Starbucks,Overlake Fashion Plaza, 15000 NE 24th St, Redmond, WA 98052</th>
								<th><a target="_blank" href="https://www.google.com/maps/dir/546+156th+Ave+SE,+Bellevue,+WA+98007/
									Starbucks,+Overlake+Fashion+Plaza,+15000+NE+24th+St,+Redmond,+WA+98052/@47.6178867,-122.1497,14z
									/data=!3m1!4b1!4m13!4m12!1m5!1m1!1s0x54906c333b56747b:0x842e9a13e8e6fc9d!2m2!1d-122.1311222!2">https://www.google.com/maps/dir/546+156th+Ave+SE,+Bellevue,+WA+98007/
									Starbucks,+Overlake+Fashion+Plaza,+15000+NE+24th+St,+Redmond,+WA+98052/@47.6178867,-122.1497,14z
									/data=!3m1!4b1!4m13!4m12!1m5!1m1!1s0x54906c333b56747b:0x842e9a13e8e6fc9d!2m2!1d-122.1311222!2</a></th>
								<th><a href="http://bit.ly/1R8wV0E" target="_blank">bit.ly/1R8wV0E</a></th>
								<th><button type="button" class="btn btn-success linkBtn" value="http://bit.ly/1R8wV0E">Get Info</button></th>
							</tr>
							<tr>
								<th><input type="radio" name="destination" value="47.633305, -122.142217"/></th>
								<th>Thai restaurant near my office</th>
								<th> Bai Tong Restaurant, Overlake Fashion Plaza, 14804 NE 24th St, Redmond, WA 98052</th>
								<th><a target="_blank" href="https://www.google.com/maps/dir/546+156th+Ave+SE,+Bellevue,+WA+98007/
									Bai+Tong+Restaurant+in+Redmond,+Overlake+Fashion+Plaza,+14804+NE+24th+St,+Redmond,+WA+98052/@47.6175579,-122.1497,14z/am=t
									/data=!3m1!4b1!4m13!4m12!1m5!1m1!1s0x54906c333b56747b:0x842e9a13e8e6fc9d!2m2!1d-122.1311222!2d47.6039896!1m5!1m1!1s0x54906d084e56c933:0xaafae9559b60634a!2m2!1d-122.141725!2d47.631838">https://www.google.com/maps/dir/546+156th+Ave+SE,+Bellevue,+WA+98007/
									Bai+Tong+Restaurant+in+Redmond,+Overlake+Fashion+Plaza,+14804+NE+24th+St,+Redmond,+WA+98052/@47.6175579,-122.1497,14z/am=t
									/data=!3m1!4b1!4m13!4m12!1m5!1m1!1s0x54906c333b56747b:0x842e9a13e8e6fc9d!2m2!1d-122.1311222!2d47.6039896!1m5!1m1!1s0x54906d084e56c933:0xaafae9559b60634a!2m2!1d-122.141725!2d47.631838</a></th>
								<th><a href="http://bit.ly/1LzBZuL" target="_blank">bit.ly/1LzBZuL</a></th>
								<th><button type="button" class="btn btn-success linkBtn" value="http://bit.ly/1LzBZuL">Get Info</button></th>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>

		<div class="row" style="margin-left: 2%;">
			<!-- Standard button -->
			<button type="button" class="btn btn-sm btn-success" id="addFavorite"> Add a favorite </button>
			<button type="button" class="btn btn-sm btn-info" id="getDirections">Get Directions</button>
			<button type="button" class="btn btn-sm btn-warning" id="getHistory"> Routes Accessed </button>
		</div>
	</div>

	<br />

	<div id="right-panel"></div>

	<div id="map"></div>
	
	<!-- Modal -->
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="myModalLabel">Link Information</h4>
	      </div>
	      <div class="modal-body">
	        
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
	      </div>
	    </div>
	  </div>
	</div>
		
	<!-- Modal -->
	<div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="myModalLabel">Add new link</h4>
	      </div>
	      <div class="modal-body">
					<form class="form-horizontal">
						<div class="form-group">
							<label for="inputName" class="col-sm-2 control-label">Name</label>
							<div class="col-sm-10">
								<input type="text" class="form-control" id="inputName"
									placeholder="Example: AT&T ">
							</div>
						</div>
						<div class="form-group">
							<label for="inputAddress" class="col-sm-2 control-label">Address</label>
							<div class="col-sm-10">
								<input type="text" class="form-control" id="inputAddress"
									placeholder="Example: AT&T, Microsoft, West Campus Commons, 15251 NE 40th Street, Redmond, WA 98052 ">
							</div>
						</div>
						<div class="form-group">
							<label for="inputLongURL" class="col-sm-2 control-label">Long URL</label>
							<div class="col-sm-10">
								<input type="text" class="form-control" id="inputLongURL"
									placeholder="Example: https://www.google.com/maps/dir/546+156th+Ave+SE,+Bellevue,+WA+98007/AT%26T,+Microsoft,+West+Campus+Commons,+15251+NE+40th+Street,+Redmond,+WA+98052/@47.6223596,-122.1719336,13z/am=t/data=!3m1!4b1!4m13!4m12!1m5!1m1!1s0x54906c333b56747b:0x842e9a13e8e6fc9d!2m2!1d-122.1311222!2d47.6039896!1m5!1m1!1s0x54906d6c3a363bcb:0x21b5f78938b93250!2m2!1d-122.13671!2d47.644446">
							</div>
						</div>
					</form>
				</div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" id="mymodal2Close">Close</button>
	      </div>
	    </div>
	  </div>
	</div>

	<div class="modal fade" id="myModal3" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="myModalLabel">Routes History</h4>
	      </div>
				<div class="modal-body">
					<table class="table table-striped table-condensed table-bordered"
						id="historyRoutes">
						<thead>
							<tr>
								<th>#</th>
								<th>Name</th>
								<th>Short URL</th>
							</tr>
						</thead>
						<tbody>
						</tbody>
					</table>
				</div>
				<div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
	      </div>
	    </div>
	  </div>
	</div>

	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script
		src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

	<!-- Include all compiled plugins (below), or include individual files as needed -->
	<script src="bootstrap/js/bootstrap.min.js"></script>

	<script>
		var map;
		var infowindow;

		//The below function finds which are the coffee shops located nearby the office
		function initMap() {
			var myoffice = {
				lat : 47.645137,
				lng : -122.122208
			};

			map = new google.maps.Map(document.getElementById('map'), {
				center : myoffice,
				zoom : 10
			});

	    }

		
	</script>
	<script
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC4bSxQE9ocKWuRCLK-_kbE_iD4KMVa_ck&libraries=places&callback=initMap"></script>

	<script>
		$(document).ready(function() {
							/** Click func() to get directions to the office
							 *	1. Once the button is clicked, a list of selected coffee shops is built
							 *	2. The transportation mode is set
							 *	3. User's current location is determined and set as the startAddress
							 * 	4. Finally, directions to the destination are calculated	
							 **/
							$('#getDirections').click(function() {
									var startAddress = "47.604004,-122.131133"
									var endAddress = $('input[name=destination]:checked', '#favPlaces').val()
									initMap1(startAddress, endAddress);
							});
							
							
							$(document).on('click', "button.linkBtn", function(){ 
								var url=$(this).val();
								var encodedURL="https://api-ssl.bitly.com/v3/link/clicks?access_token=279564e2df7cd9d12c7d892318111aa31f81b1a1&link="+encodeURIComponent(url);
								console.log(encodedURL);
								$.ajax({
									   url: encodedURL,
									   type: 'GET',
									   dataType: 'jsonp',
									   error: function() {
									      console.log("in error!!!");
									   },
									   success: function(results) {
										  $('.modal-body').html('');
										  var clickCountDiv="<h4> #Clicks: "+results.data.link_clicks+"</h4>";
 										  $('.modal-body').append(clickCountDiv)
 										  $('.modal-body').append("<br />");
 										  $('#myModal').modal('show');
									   }
								});
							});
							
							$('#addFavorite').click(function(){
								$('#myModal2').modal('show');
								
							});
							
							$('#mymodal2Close').click(function(){
								var inputName=$('#inputName').val();
								var inputAddress = $('#inputAddress').val();
								var inputLongURL = $('#inputLongURL').val();
								var encodedURL =  "https://api-ssl.bitly.com/v3/user/link_save?access_token=279564e2df7cd9d12c7d892318111aa31f81b1a1&title="+inputName+"&longUrl="+encodeURIComponent(inputLongURL);
								$.ajax({
									   url: encodedURL,
									   type: 'GET',
									   dataType: 'jsonp',
									   error: function() {
									      console.log("in error!!!");
									   },
									   success: function(results) {
										   var bitLyLink=results.data.link_save.link;
										   var stripHttp=bitLyLink.replace(/.*?:\/\//g, "");
										   var tableRow=
												'<tr> \
												 <th><input type="radio" name="destination" value=""/></th> \
												 <th>'+ inputName +'</th> \
												 <th>'+ inputAddress + '</th> \
												 <th><a target="_blank" href="' + inputLongURL + '">' + inputLongURL + '</a></th> \
												 <th><a href="'+bitLyLink+'" target="_blank">'+ stripHttp + '</a></th> \
												 <th><button type="button" class="btn btn-success linkBtn" value="' + bitLyLink + '">Get Info</button></th></tr>';
											
											$('#favPlaces').append(tableRow);	 
											$('#myModal2').modal('hide');
									   }
									  
								});
								
							});
							
							$('#getHistory').click(function(){
								var encodedURL="https://api-ssl.bitly.com/v3/user/link_history?access_token=279564e2df7cd9d12c7d892318111aa31f81b1a1";
								$.ajax({
									   url: encodedURL,
									   type: 'GET',
									   dataType: 'jsonp',
									   error: function() {
									      console.log("in error!!!");
									   },
									   success: function(results) {
										   var i=1;
										   $.each(results.data.link_history,function(key,value){
											   var tableRow=
													'<tr> \
													 <th>'+i+'</th>\
													 <th>'+value.title+'</th>\
													 <th>'+value.link+'</th>\
													 </tr>';
												 	 i++;
												$('#historyRoutes').append(tableRow); 
								
										   });
											$('#myModal3').modal('show');
										}
								});
								
							});
							
							
						});

						function initMap1(startAddress, endAddress) {

						var directionsDisplay = new google.maps.DirectionsRenderer;	
						var directionsService = new google.maps.DirectionsService;
						var map = new google.maps.Map(document.getElementById('map'), {
							zoom : 7,
							center : {

								lat : 47.645014,
								lng : -122.122219
							}
						});
						var infoWindow = new google.maps.InfoWindow({
							map : map
						});

						directionsDisplay.setMap(map);
						directionsDisplay.setPanel(document.getElementById('right-panel'));
						calculateAndDisplayRoute(directionsService, directionsDisplay,startAddress,endAddress);

						}

						function calculateAndDisplayRoute(directionsService, directionsDisplay,startAddress, endAddress) {
						var start = String(startAddress);

						//This is the destination address i.e. to my office
						var end = String(endAddress);

						directionsService.route({
								origin : start,
								destination : end,
								waypoints : [],
								travelMode : google.maps.TravelMode.DRIVING
						}, function(response, status) {
						if (status === google.maps.DirectionsStatus.OK) {
							$('#right-panel').html('');
							directionsDisplay.setDirections(response);
						} else {
							window.alert('Directions request failed due to ' + status);
						}
			});
		}
	</script>


</body>
</html>
